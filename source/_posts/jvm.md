---
title: jvm
date: 2019-04-10 15:20:22
tags: 学习 输出 按部就班
---
### 类加载器深入解析与阶段分解
#### 类加载机制
- 在Java代码中，`类型`（class）的加载、连接与初始化过程都是在程序`运行期间`完成的；
- 通过这种方式提供了更大的灵活性，增加了更多的可能性。

#### 阶段分解
- 加载：查找并加载类的二进制数据，将类的class文件从磁盘加载到内存；
- 连接：
    将类与类的关系给确定好，将类与类之间符号引用转换成直接引用，并且对字节码进行相关的处理、验证。
    - 验证：确保被加载类的正确性；
    - 准备：为类的`静态变量`分配内存，并将其`初始化为默认值`；
    - 解析：把类中的符号引用转换为直接引用；
- 初始化：为类的静态变量赋予正确的初始值（真实值覆盖默认值）。
- 使用
- 卸载

#### 类加载器Classloader
Java虚拟机与程序的生命周期，在如下几种情况下，Java虚拟机将结束生命周期
- 执行了System.exit()方法；
- 程序正常执行结束；
- 程序在执行过程中遇到了异常或错误而异常终止；
- 由于操作系统出现错误而导致Java虚拟机进程终止。

### 类的加载连接与初始化过程详解

#### Java程序对类对使用方式可分为两种
- 主动使用：
    - 创建类的实例；
    - 访问某个类或接口的静态变量，或者对该静态变量赋值（被final修饰、已在编译期把结果放入常量池的静态字段除外）；
    - 调用类的静态方法；
    - 反射（如：Class.forName("com.geekymv.MyTest")）；
    - 初始化一个类的子类；
    - Java虚拟机启动时被标明为启动类的类（包含main方法的类）；
    - jdk1.7开始提供的动态语言支持，java.lang.invoke.methodHandle实例的解析结果REF_getStatic, REF_putStatic, REF_invokeStatic句柄对应的类没有初始化则初始化。
    
- 被动使用：除了以上7种情况，其他使用Java类的方式都被看作是对类的被动使用，都不会导致类的初始化。

所有的Java虚拟机实现必须在每个类或接口被Java程序`首次主动使用`才初始化。

#### 类的加载
类的加载指的是将类的.class文件中的二进制数据读入到内存中，将其放在运行时数据区的`方法区`内，然后在内存中创建一个java.lang.Class对象
（Java虚拟机规范中并未说明Class对象位于哪里，HotSpot虚拟机将其放在了方法区中）用来封装类在方法区内的数据结构。

加载.class文件的方式
- 从本地系统中直接加载；
- 通过网络下载.class文件；
- 从zip、jar等归档文件中加载.class文件；
- 从专有数据库中提取.class文件；
- 将Java源文件动态编译为.class文件。



#### 垃圾收集器


监控工具使用
jconsole
jvisualvm
jmap
jstack

锁
线程安全
偏向锁、自旋锁与轻量级锁

逃逸分析
内存模型


#### 垃圾收集算法
- 标记清除
- 复制算法
- 标记整理

- 分代收集
新生代：复制算法
老年代：标记清除或标记整理

#### 垃圾收集器
CMS
G1

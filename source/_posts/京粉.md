业余时间给个人公众号开发京东返利功能

开发过程中使用的相关技术
- [Fiddler 抓包](https://www.telerik.com/fiddler)：，抓取京粉APP中转链接口请求
- [Spring Boot](https://spring.io/projects/spring-boot)：开发公众号接口服务
- [WxJava](https://github.com/Wechat-Group/WxJava)：SDK封装了微信公众平台上大部分Api接口 
- [Hutool](https://www.hutool.cn/)：Java工具包，用于发送http请求，调用转链接口获取推广链接
- [MyBatis-Plus](https://mp.baomidou.com/) ORM 框架
- [MySQL](https://www.mysql.com/) 存储用户转链信息
- [ngrok](https://ngrok.com/) 一个让外网访问本机的工具


##### 选购商品


##### 京粉APP抓包
对于怎么安装Fiddler工具，以及怎么使用Fiddler抓手机APP包，大家可以自行搜索，网上有很多的教程，我也是自己通过一点点搜索，然后自己动手操作。


- 请求信息
```text
GET https://qwd.jd.com/cps/zl?content=https%3A%2F%2Fitem.m.jd.com%2Fproduct%2F12469371.html%3Fwxa_abtest%3Do%26ad_od%3Dshare%26utm_source%3Dandroidapp%26utm_medium%3Dappshare%26utm_campaign%3Dt_335139774%26utm_term%3DCopyURL&shareSource=1_2_1 HTTP/1.1
Cookie: client_type=android;app_id=161;login_mode=2;jxjpin=jd_42aa223e6xxxx;tgt=AAJeuTwzAEAdX7JcRYrDc-xxxxxx-nP2jmXqbzbt3_mqbVFUWvkRlAyg6S9kVZW_4rzxFwvAKxxxxxxxN9_xoWMRSaYuTWhL;qwd_chn=99;qwd_schn=1;jfShareSource=1_2_1
User-Agent: jxj/3.7.2
Host: qwd.jd.com
Connection: Keep-Alive
Accept-Encoding: gzip
```
通过分析可以看出来GET请求参数中的content就是我们输入的商品地址，则通用接口请求是 https://qwd.jd.com/cps/zl?content=输入的商品地址&shareSource=1_2_1
我们需要将Cookie拷贝下来保存到一个配置文件中，后面会用到。

- 响应信息
```text
{"content":"【京东】曾国藩传（张宏杰新作，随书附赠曾国藩家书典藏本）\n————————\n京东价：¥68.00\n抢购链接：https://u.jd.com/aLkrvK\n","errCode":"0","skuInfos":[{"skuId":12469371,"imageUrl":"//m.360buyimg.com/mobilecms/s750x750_jfs/t1/31008/15/1311/244914/5c497860E7e814e9b/48fe7909246755ec.jpg","commission":2.72,"unionUrl":"https://u.jd.com/aLkrvK"}],"moreGoodsUrl":"https://u.jd.com/4CyTLd","doubtfulUrls":[]}
```
接口响应信息我们可以通过http://json.cn 这个工具来格式化下



通过与京粉APP转链结果对比分析：
commission 字段表示预估佣金，unionUrl 就是我们需要的转链后的抢购链接。
至此抓包部分已经完成了，后面我们会使用Hutool工具类（当然也可以自己去编写一个HttpUtil）模拟发送转链请求获取推广链接。

##### 公众号开发
打包微信公众号管理后台（），找到 开发-基本配置


微信官方也提供了入门指引 https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Getting_Started_Guide.html
其中包含微信开放平台的基础常见功能，看完这些对于本文要实现的功能已经绰绰有余了。


